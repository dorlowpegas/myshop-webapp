<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>–ú–æ–π –º–∞–≥–∞–∑–∏–Ω</title>
  <link rel="stylesheet" href="/static/css/style.css">
</head>
<body>
  <div class="container">
    <header class="header">
      <h1>üçì –ú–æ–π –º–∞–≥–∞–∑–∏–Ω</h1>
      <div class="cart-icon" onclick="openCart()">
        üõí <span id="cart-count">0</span>
      </div>
    </header>

    <!-- –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ -->
    <div class="categories">
      <button onclick="filterProducts('all')" class="category-btn active" id="btn-all">–í—Å–µ</button>
      <button onclick="filterProducts('–±–µ–Ω—Ç–æ')" class="category-btn" id="btn-–±–µ–Ω—Ç–æ">–ë–µ–Ω—Ç–æ-—Ç–æ—Ä—Ç—ã</button>
      <button onclick="filterProducts('–∫–ª—É–±–Ω–∏–∫–∞')" class="category-btn" id="btn-–∫–ª—É–±–Ω–∏–∫–∞">–ö–ª—É–±–Ω–∏–∫–∞ –≤ —à–æ–∫–æ–ª–∞–¥–µ</button>
      <button onclick="filterProducts('–¥—Ä—É–≥–æ–µ')" class="category-btn" id="btn-–¥—Ä—É–≥–æ–µ">–î—Ä—É–≥–æ–µ</button>
    </div>

    <div id="products"></div>
    <a href="/admin">–ê–¥–º–∏–Ω–∫–∞ (—Ç–æ–ª—å–∫–æ –¥–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞)</a>
  </div>

  <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –∫–æ—Ä–∑–∏–Ω—ã -->
  <div id="cart-modal" class="modal">
    <div class="modal-content">
      <h2>üõí –í–∞—à–∞ –∫–æ—Ä–∑–∏–Ω–∞</h2>
      <div id="cart-items"></div>
      <p><strong>–ò—Ç–æ–≥–æ: <span id="cart-total">0</span> ‚ÇΩ</strong></p>
      <form id="order-form">
        <input type="text" id="name" placeholder="–í–∞—à–µ –∏–º—è" required />
        <input type="tel" id="phone" placeholder="–¢–µ–ª–µ—Ñ–æ–Ω" required />
        <textarea id="address" placeholder="–ê–¥—Ä–µ—Å –¥–æ—Å—Ç–∞–≤–∫–∏" required></textarea>
        <button type="submit">–û—Ñ–æ—Ä–º–∏—Ç—å –∑–∞–∫–∞–∑</button>
      </form>
      <button onclick="closeCart()">–ó–∞–∫—Ä—ã—Ç—å</button>
    </div>
  </div>

  <script src="/static/js/cart.js"></script>
  <script>
    let allProducts = []; // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤—Å–µ —Ç–æ–≤–∞—Ä—ã
    let currentCategory = 'all';

    // –ó–∞–≥—Ä—É–∑–∫–∞ —Ç–æ–≤–∞—Ä–æ–≤
    async function loadProducts() {
      const res = await fetch('/api/products');
      allProducts = await res.json();
      renderProducts(allProducts);
    }

    // –†–µ–Ω–¥–µ—Ä —Ç–æ–≤–∞—Ä–æ–≤
    function renderProducts(products) {
      const container = document.getElementById('products');
      container.innerHTML = products.map(p => `
        <div class="product-card">
          <div class="product-image-container">
            <img src="${p.image}" alt="${p.name}" class="product-image">
          </div>
          <div class="product-info">
            <h3>${p.name}</h3>
            <p class="price">${p.price} ‚ÇΩ</p>
            <p>${p.description}</p>
            <button onclick="addToCart(${p.id}, '${p.name}', ${p.price})">–ö—É–ø–∏—Ç—å</button>
          </div>
        </div>
      `).join('');
    }

    // –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
    function filterProducts(category) {
      currentCategory = category;

      // –°–±—Ä–æ—Å–∏—Ç—å –∞–∫—Ç–∏–≤–Ω—ã–µ –∫–Ω–æ–ø–∫–∏
      document.querySelectorAll('.category-btn').forEach(btn => {
        btn.classList.remove('active');
      });

      // –ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å —Ç–µ–∫—É—â—É—é
      document.getElementById(`btn-${category}`).classList.add('active');

      if (category === 'all') {
        renderProducts(allProducts);
      } else {
        const filtered = allProducts.filter(p => p.category === category);
        renderProducts(filtered);
      }
    }

    loadProducts();
    updateCart();
  </script>
</body>
</html>