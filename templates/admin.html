<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>–ê–¥–º–∏–Ω–∫–∞</title>
  <link rel="stylesheet" href="/static/css/style.css">
</head>
<body>
  <div class="container">
    <h1>üîß –ê–¥–º–∏–Ω–∫–∞</h1>
    <button onclick="addProduct()">+ –î–æ–±–∞–≤–∏—Ç—å —Ç–æ–≤–∞—Ä</button>
    <div id="products-list"></div>
  </div>

  <div id="edit-form" style="display:none; margin-top:30px; padding:20px; border:1px solid #ccc;">
    <h2 id="form-title">–î–æ–±–∞–≤–∏—Ç—å —Ç–æ–≤–∞—Ä</h2>
    <input type="hidden" id="product-id">
    <div>
      <label>–ù–∞–∑–≤–∞–Ω–∏–µ</label><br>
      <input type="text" id="name" style="width:100%; padding:8px;" required>
    </div>
    <div>
      <label>–¶–µ–Ω–∞</label><br>
      <input type="number" id="price" style="width:100%; padding:8px;" required>
    </div>
    <div>
      <label>–ö–∞—Ç–µ–≥–æ—Ä–∏—è</label><br>
      <input type="text" id="category" style="width:100%; padding:8px;" placeholder="–∫–ª—É–±–Ω–∏–∫–∞ / –±–µ–Ω—Ç–æ" required>
    </div>
    <div>
      <label>–û–ø–∏—Å–∞–Ω–∏–µ</label><br>
      <textarea id="description" style="width:100%; padding:8px;" rows="3"></textarea>
    </div>
    <div>
      <label>URL –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è (–Ω–∞–ø—Ä–∏–º–µ—Ä: /static/images/placeholder.jpg)</label><br>
      <input type="text" id="image" style="width:100%; padding:8px;" value="/static/images/placeholder.jpg" required>
    </div>
    <br>
    <button onclick="saveProduct()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
    <button onclick="document.getElementById('edit-form').style.display='none'">–û—Ç–º–µ–Ω–∞</button>
  </div>

  <script>
    let products = [];

    async function loadProducts() {
      const res = await fetch('/api/products');
      products = await res.json();
      renderList();
    }

    function renderList() {
      const container = document.getElementById('products-list');
      container.innerHTML = products.map(p => `
        <div style="border:1px solid #eee; padding:10px; margin:10px 0;">
          <strong>${p.name}</strong> ‚Äî ${p.price} ‚ÇΩ
          <button onclick="editProduct(${p.id})">‚úèÔ∏è</button>
          <button onclick="deleteProduct(${p.id})">üóëÔ∏è</button>
        </div>
      `).join('');
    }

    function addProduct() {
      document.getElementById('form-title').innerText = '–î–æ–±–∞–≤–∏—Ç—å —Ç–æ–≤–∞—Ä';
      document.getElementById('product-id').value = '';
      document.getElementById('name').value = '';
      document.getElementById('price').value = '';
      document.getElementById('category').value = '';
      document.getElementById('description').value = '';
      document.getElementById('image').value = '/static/images/placeholder.jpg';
      document.getElementById('edit-form').style.display = 'block';
    }

    function editProduct(id) {
      const product = products.find(p => p.id === id);
      if (!product) return;

      document.getElementById('form-title').innerText = '–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Ç–æ–≤–∞—Ä';
      document.getElementById('product-id').value = product.id;
      document.getElementById('name').value = product.name;
      document.getElementById('price').value = product.price;
      document.getElementById('category').value = product.category;
      document.getElementById('description').value = product.description;
      document.getElementById('image').value = product.image;
      document.getElementById('edit-form').style.display = 'block';
    }

    async function deleteProduct(id) {
      if (!confirm('–£–¥–∞–ª–∏—Ç—å —Ç–æ–≤–∞—Ä?')) return;
      await fetch(`/api/products/${id}`, { method: 'DELETE' });
      loadProducts();
    }

    async function saveProduct() {
      const id = document.getElementById('product-id').value;
      const product = {
        id: id ? parseInt(id) : null,
        name: document.getElementById('name').value,
        price: parseFloat(document.getElementById('price').value),
        category: document.getElementById('category').value,
        description: document.getElementById('description').value,
        image: document.getElementById('image').value,
        composition: "–ö–ª—É–±–Ω–∏–∫–∞, —à–æ–∫–æ–ª–∞–¥",
        packaging: "–ü–æ–¥–∞—Ä–æ—á–Ω–∞—è –∫–æ—Ä–æ–±–∫–∞",
        shelfLife: "48 —á–∞—Å–æ–≤",
        delivery: "–ü–æ –≥–æ—Ä–æ–¥—É"
      };

      await fetch('/api/products', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(product)
      });

      document.getElementById('edit-form').style.display = 'none';
      loadProducts();
    }

    loadProducts();
  </script>
</body>
</html>